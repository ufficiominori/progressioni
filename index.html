<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Calcolo punteggio (in aggiornamento) – Progressione Area Funzionari/EQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
    }
    fieldset {
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      padding: 10px;
    }
    #fsProcedura { background-color: #e6f2ff; }
    #fsPerformance { background-color: #e6ffe6; }
    #fsBlocchiB { background-color: #fff5e6; }
    #fsIncarichi { background-color: #f3e6ff; }

    legend { font-weight: bold; }
    label { display: block; margin-top: 5px; }
    input[type="number"], select {
      width: 50%;
      max-width: 260px;
      box-sizing: border-box;
      font-size: 1.1rem;
      padding: 6px 8px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 16px;
      font-size: 1rem;
      cursor: pointer;
    }
    .block-score {
      margin-top: 5px;
      font-style: italic;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal {
      background: #ffffff;
      border-radius: 8px;
      max-width: 480px;
      width: 90%;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }
    .modal h3 { margin-top: 0; margin-bottom: 10px; }
    .modal .result-text {
      font-size: 1.5rem;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .modal .details {
      font-size: 0.95rem;
      margin-bottom: 15px;
    }
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .btn-primary, .btn-secondary {
      border: none;
      border-radius: 4px;
      color: #fff;
      padding: 8px 12px;
      cursor: pointer;
    }
    .btn-primary { background-color: #007bff; }
    .btn-secondary { background-color: #6c757d; }

    @media (max-width: 600px) {
      body { font-size: 0.95rem; }
      fieldset { margin-bottom: 12px; }
      button { width: 100%; }
      .modal { padding: 16px; }
      .modal-buttons { justify-content: center; }
      .modal-buttons button { flex: 1 1 auto; }
    }
  </style>
</head>
<body>

<h2>Calcolo punteggio (in aggiornamento) – Area Funzionari e dell’Elevata Qualificazione</h2>
<h3>a cura del Mar. Ord. Carmine Santangelo</h3>
<h4>N.B.: il programma è in fase di aggiornamento e verifica, pertanto potrebbe riportare risultati errati</h4>

<!-- TIPO PROCEDURA -->
<fieldset id="fsProcedura">
  <legend>TIPO DI PROCEDURA</legend>
  <label>
    <input type="radio" name="procedura" value="art15" checked>
    Procedura comparativa ex art. 15 CCNL
  </label>
  <label>
    <input type="radio" name="procedura" value="art13">
    Procedura straordinaria ex art. 13 CCNL
  </label>
</fieldset>

<!-- A - PERFORMANCE -->
<fieldset id="fsPerformance">
  <legend>A – VALUTAZIONE DELLA PERFORMANCE (solo art. 15 – max 20)</legend>
  <label>
    Punteggio performance (0–20):
    <input type="number" id="performance" min="0" max="20" step="0.1" value="0">
  </label>
  <div class="block-score" id="scorePerformance"></div>
</fieldset>

<!-- B - TITOLI E COMPETENZE -->
<fieldset id="fsBlocchiB">
  <legend>B – TITOLI E COMPETENZE PROFESSIONALI (max 60)</legend>

  <!-- B.1 TITOLI DI STUDIO -->
  <h4>Titoli di studio (max 30)</h4>

  <!-- B.1.2 VOTO TITOLO ACCESSO -->
  <h5>B.1.2 Voto titolo di accesso (max 10)</h5>
  <label>
    Tipo di titolo di accesso (max 10 punti):
    <select id="tipoTitoloAccesso">
      <option value="diploma">Diploma di scuola secondaria di II grado</option>
      <option value="L">Laurea triennale (L)</option>
      <option value="LM">Laurea magistrale / DL / LS / LM</option>
    </select>
  </label>
  <label>
    Voto del titolo di accesso:
    <input type="number" id="votoAccesso" min="60" max="110" step="0.5" value="100">
  </label>
  <label>
    <input type="checkbox" id="lodeAccesso"> con lode
  </label>
  <div class="block-score" id="scoreVotoAccesso"></div>

  <!-- B.1.3 TITOLI ULTERIORI -->
  <h5>B.1.3 Titoli ulteriori (oltre il titolo di accesso – max 20)</h5>
  <label>
    Numero di lauree triennali ulteriori:
    <input type="number" id="numLTriennali" min="0" step="1" value="0">
  </label>
  <label>
    Numero di lauree DL/LS/LM ulteriori:
    <input type="number" id="numLaureeLM" min="0" step="1" value="0">
  </label>
  <label>
    Numero di Master universitari di I livello:
    <input type="number" id="numMaster1" min="0" step="1" value="0">
  </label>
  <label>
    Numero di Master di II livello / Dottorati / Scuole di Specializzazione:
    <input type="number" id="numMaster2" min="0" step="1" value="0">
  </label>
  <div class="block-score" id="scoreTitoliUlteriori"></div>

  <!-- B.2 COMPETENZE PROFESSIONALI -->
  <h4>Competenze professionali (max 30)</h4>

  <label>
    Anno di assunzione (es. 2000 – esperienza max 25 punti):
    <input type="number" id="annoAssunzione" min="1900" max="2025" step="1" value="2000">
  </label>
  <label>
    Abilitazione ad albo professionale (0 = no, 1 = sì – max 3 punti):
    <input type="number" id="abilitazione" min="0" max="1" step="1" value="0">
  </label>
  <label>
    Numero certificazioni informatiche (0,25 punti ciascuna – max 0,5 punti):
    <input type="number" id="numCertInformatica" min="0" step="1" value="0">
  </label>
  <label>
    Numero certificazioni linguistiche QCER ≥ B1 (0,25 punti ciascuna – max 0,5 punti):
    <input type="number" id="numCertLingue" min="0" step="1" value="0">
  </label>
  <label>
    Idoneità in selezioni a tempo indeterminato (0 = no, 1 = sì – max 1 punto):
    <input type="number" id="idoneitaSelezione" min="0" max="1" step="1" value="0">
  </label>
  <label>
    Punteggio colloquio (0–10, solo art. 13 – rientra nel limite di B max 60):
    <input type="number" id="punteggioColloquio" min="0" max="10" step="0.1" value="0">
  </label>

  <div class="block-score" id="scoreCompetenze"></div>
</fieldset>

<!-- C - INCARICHI -->
<fieldset id="fsIncarichi">
  <legend>C – INCARICHI RIVESTITI (max 20)</legend>
  <label>
    Numero incarichi formali attinenti al profilo:
    <input type="number" id="numIncarichi" min="0" step="1" value="0">
  </label>
  <div class="block-score" id="scoreIncarichi"></div>
</fieldset>

<button onclick="calcola()">Calcola punteggio</button>

<!-- MODALE RISULTATO -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <h3>Risultato del calcolo</h3>
    <div class="result-text" id="modalTotale"></div>
    <div class="details" id="modalDettagli"></div>
    <div class="modal-buttons">
      <button class="btn-secondary" onclick="chiudiModal()">Chiudi</button>
      <button class="btn-primary" onclick="nuovoCalcolo()">Nuovo calcolo</button>
    </div>
  </div>
</div>

<script>
function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}

function mostraModal(testoTotale, dettagli) {
  document.getElementById('modalTotale').textContent = testoTotale;
  document.getElementById('modalDettagli').innerHTML = dettagli;
  document.getElementById('modalOverlay').style.display = 'flex';
}

function chiudiModal() {
  document.getElementById('modalOverlay').style.display = 'none';
}

function nuovoCalcolo() {
  document.getElementById('performance').value = 0;
  document.getElementById('tipoTitoloAccesso').value = 'diploma';
  document.getElementById('votoAccesso').value = 100;
  document.getElementById('lodeAccesso').checked = false;
  document.getElementById('numLTriennali').value = 0;
  document.getElementById('numLaureeLM').value = 0;
  document.getElementById('numMaster1').value = 0;
  document.getElementById('numMaster2').value = 0;
  document.getElementById('annoAssunzione').value = 2000;
  document.getElementById('abilitazione').value = 0;
  document.getElementById('numCertInformatica').value = 0;
  document.getElementById('numCertLingue').value = 0;
  document.getElementById('idoneitaSelezione').value = 0;
  document.getElementById('punteggioColloquio').value = 0;
  document.getElementById('numIncarichi').value = 0;

  ['scorePerformance','scoreVotoAccesso','scoreTitoliUlteriori',
   'scoreCompetenze','scoreIncarichi']
    .forEach(id => document.getElementById(id).textContent = '');

  chiudiModal();
}

function calcola() {
  const procedura = document.querySelector('input[name="procedura"]:checked').value;

  // B.2 – ESPERIENZA (dentro competenze, max 25)
  const annoAssunzione = parseInt(document.getElementById('annoAssunzione').value, 10);
  const annoRiferimento = 2025;
  let anniServizio = 0;
  let anniExtra = 0;
  if (!isNaN(annoAssunzione) && annoAssunzione <= annoRiferimento) {
    anniServizio = annoRiferimento - annoAssunzione;
    anniExtra = Math.max(anniServizio - 3, 0);
  }
  let puntiEsperienza;
  if (procedura === 'art13') {
    puntiEsperienza = anniExtra * 1.6;     // art.13: 1,6 per anno extra, max 40 da regolamento
  } else {
    puntiEsperienza = anniExtra;           // art.15: 1 per anno extra, max 25 da regolamento
  }
  puntiEsperienza = clamp(puntiEsperienza, 0, 25);  // limite esperienza in B.2 art.15 [file:1]

  // A – PERFORMANCE (solo art.15)
  let punteggioPerformance = 0;
  if (procedura === 'art15') {
    punteggioPerformance = parseFloat(document.getElementById('performance').value) || 0;
    punteggioPerformance = clamp(punteggioPerformance, 0, 20);   // max 20 [file:1]
    document.getElementById('scorePerformance').textContent =
      'A – Performance: ' + punteggioPerformance.toFixed(2);
  } else {
    document.getElementById('scorePerformance').textContent =
      'A – Non rilevante per art. 13';
  }

  // B.1.2 – VOTO TITOLO DI ACCESSO (max 10)
  const tipoTitoloAccesso = document.getElementById('tipoTitoloAccesso').value;
  const votoAccesso = parseFloat(document.getElementById('votoAccesso').value) || 0;
  const lodeAccesso = document.getElementById('lodeAccesso').checked;
  let punteggioVotoAccesso = 0;

  if (tipoTitoloAccesso === 'diploma') {
    if (votoAccesso >= 100)      punteggioVotoAccesso = 3;
    else if (votoAccesso >= 90)  punteggioVotoAccesso = 2;
    else if (votoAccesso >= 80)  punteggioVotoAccesso = 1.5;
    else if (votoAccesso >= 70)  punteggioVotoAccesso = 1;
    else if (votoAccesso >= 60)  punteggioVotoAccesso = 0.5;
  } else if (tipoTitoloAccesso === 'L') {
    if (votoAccesso >= 110 && lodeAccesso) punteggioVotoAccesso = 6;
    else if (votoAccesso >= 103)           punteggioVotoAccesso = 5;
    else if (votoAccesso >= 90)            punteggioVotoAccesso = 4;
    else if (votoAccesso >= 80)            punteggioVotoAccesso = 3;
    else if (votoAccesso >= 70)            punteggioVotoAccesso = 2;
    else if (votoAccesso >= 60)            punteggioVotoAccesso = 1;
  } else {
    if (votoAccesso >= 110 && lodeAccesso) punteggioVotoAccesso = 10;
    else if (votoAccesso >= 103)           punteggioVotoAccesso = 9;
    else if (votoAccesso >= 90)            punteggioVotoAccesso = 8;
    else if (votoAccesso >= 80)            punteggioVotoAccesso = 7.5;
    else if (votoAccesso >= 70)            punteggioVotoAccesso = 7;
    else if (votoAccesso >= 60)            punteggioVotoAccesso = 6.5;
  }
  punteggioVotoAccesso = clamp(punteggioVotoAccesso, 0, 10);  // max 10 [file:1]
  document.getElementById('scoreVotoAccesso').textContent =
    'B.1.2 Voto titolo di accesso: ' + punteggioVotoAccesso.toFixed(2);

  // B.1.3 – TITOLI ULTERIORI (max 20)
  const numLTriennali = parseFloat(document.getElementById('numLTriennali').value) || 0;
  const numLaureeLM   = parseFloat(document.getElementById('numLaureeLM').value) || 0;
  const numMaster1    = parseFloat(document.getElementById('numMaster1').value) || 0;
  const numMaster2    = parseFloat(document.getElementById('numMaster2').value) || 0;

  let punteggioTitoliUlteriori = 0;
  punteggioTitoliUlteriori += numLTriennali * 5;
  punteggioTitoliUlteriori += numLaureeLM * 10;
  const puntiMaster1 = Math.min(numMaster1 * 1.5, 3);
  const puntiMaster2 = Math.min(numMaster2 * 3, 7);
  punteggioTitoliUlteriori += puntiMaster1 + puntiMaster2;
  punteggioTitoliUlteriori = clamp(punteggioTitoliUlteriori, 0, 20); // max 20 [file:1]

  document.getElementById('scoreTitoliUlteriori').textContent =
    'B.1.3 Titoli ulteriori: ' + punteggioTitoliUlteriori.toFixed(2);

  // B.2 – COMPETENZE PROFESSIONALI (esperienza + abil. + inf. + lingue + idoneità + colloquio art.13)
  const abilitazione       = parseFloat(document.getElementById('abilitazione').value) || 0;
  const numCertInformatica = parseFloat(document.getElementById('numCertInformatica').value) || 0;
  const numCertLingue      = parseFloat(document.getElementById('numCertLingue').value) || 0;
  const idoneitaSelezione  = parseFloat(document.getElementById('idoneitaSelezione').value) || 0;
  const punteggioColloquio = parseFloat(document.getElementById('punteggioColloquio').value) || 0;

  const puntiAbilitazione = abilitazione > 0 ? 3 : 0;                          // max 3 [file:1]
  const puntiInformatica  = clamp(numCertInformatica * 0.25, 0, 0.5);          // max 0,5 [file:1]
  const puntiLingue       = clamp(numCertLingue * 0.25, 0, 0.5);               // max 0,5 [file:1]
  const puntiIdoneita     = clamp(idoneitaSelezione, 0, 1);                    // max 1 [file:1]
  const puntiColloquio    = procedura === 'art13'
                              ? clamp(punteggioColloquio, 0, 10)
                              : 0;                                             // colloquio solo art.13 [file:1]

  let b2_competenze = puntiEsperienza + puntiAbilitazione +
                      puntiInformatica + puntiLingue + puntiIdoneita +
                      puntiColloquio;

  b2_competenze = clamp(b2_competenze, 0, 30);                                  // B.2 max 30 [file:1]

  // B.1 totale (titoli di studio, max 30)
  const b1_titoliStudio = clamp(punteggioVotoAccesso + punteggioTitoliUlteriori, 0, 30); // [file:1]

  // Blocco B totale (max 60)
  const bloccoB = clamp(b1_titoliStudio + b2_competenze, 0, 60);                // [file:1]

  document.getElementById('scoreCompetenze').textContent =
    'B – Titoli e competenze: ' + bloccoB.toFixed(2) +
    ' (B.1: ' + b1_titoliStudio.toFixed(2) +
    ', B.2: ' + b2_competenze.toFixed(2) + ')';

  // C – INCARICHI (solo incarichi formali)
  const numIncarichi = parseFloat(document.getElementById('numIncarichi').value) || 0;
  const puntiIncarichi = clamp(numIncarichi, 0, 20);                            // max 20 [file:1]
  document.getElementById('scoreIncarichi').textContent =
    'C – Incarichi formali: ' + puntiIncarichi.toFixed(2);

  // TOTALE E DETTAGLI PER ART.13 / ART.15
  let totale, testoTotale, dettagli;

  if (procedura === 'art13') {
    // per art.13 non c’è A, ma B comprende anche colloquio [file:1]
    totale = clamp(bloccoB + puntiIncarichi, 0, 100);

    testoTotale = 'Totale art. 13: ' + totale.toFixed(2) + ' / 100';
    dettagli = `
      <h4>B – Titoli e competenze (max 60): <strong>${bloccoB.toFixed(2)}</strong></h4>
      <ul>
        <li>B.1 Titoli di studio (max 30): ${b1_titoliStudio.toFixed(2)}</li>
        <li>B.2 Competenze prof. (max 30): ${b2_competenze.toFixed(2)}
          <ul>
            <li>Esperienza: ${puntiEsperienza.toFixed(2)}</li>
            <li>Abilitazione: ${puntiAbilitazione.toFixed(2)}</li>
            <li>Informatica: ${puntiInformatica.toFixed(2)}</li>
            <li>Lingue: ${puntiLingue.toFixed(2)}</li>
            <li>Idoneità: ${puntiIdoneita.toFixed(2)}</li>
            <li>Colloquio: ${puntiColloquio.toFixed(2)}</li>
          </ul>
        </li>
      </ul>
      <h4>C – Incarichi (max 20): <strong>${puntiIncarichi.toFixed(2)}</strong></h4>
    `;
  } else {
    // art.15: A + B + C, con esperienza in B.2 e senza colloquio [file:1]
    totale = clamp(punteggioPerformance + bloccoB + puntiIncarichi, 0, 100);

    testoTotale = 'Totale art. 15: ' + totale.toFixed(2) + ' / 100';
    dettagli = `
      <h4>A – Performance (max 20): <strong>${punteggioPerformance.toFixed(2)}</strong></h4>
      <h4>B – Titoli e competenze (max 60): <strong>${bloccoB.toFixed(2)}</strong></h4>
      <ul>
        <li>B.1 Titoli di studio (max 30): ${b1_titoliStudio.toFixed(2)}
          <ul>
            <li>B.1.2 Voto titolo accesso: ${punteggioVotoAccesso.toFixed(2)}</li>
            <li>B.1.3 Titoli ulteriori: ${punteggioTitoliUlteriori.toFixed(2)}</li>
          </ul>
        </li>
        <li>B.2 Competenze prof. (max 30): ${b2_competenze.toFixed(2)}
          <ul>
            <li>Esperienza: ${puntiEsperienza.toFixed(2)}</li>
            <li>Abilitazione: ${puntiAbilitazione.toFixed(2)}</li>
            <li>Informatica: ${puntiInformatica.toFixed(2)}</li>
            <li>Lingue: ${puntiLingue.toFixed(2)}</li>
            <li>Idoneità: ${puntiIdoneita.toFixed(2)}</li>
          </ul>
        </li>
      </ul>
      <h4>C – Incarichi rivestiti (max 20): <strong>${puntiIncarichi.toFixed(2)}</strong></h4>
    `;
  }

  mostraModal(testoTotale, dettagli);
}
</script>

</body>
</html>
